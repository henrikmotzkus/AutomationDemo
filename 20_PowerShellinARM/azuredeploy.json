{
    "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "parameters": {
      "DisplayName": {
        "type": "string"
      },
      "Description": {
        "type": "string"
      },
      "CompanyName": {
        "type": "string"
      },
      "Secret": {
        "type": "string"
      },
      "utcValue": {
        "type": "string",
        "defaultValue": "[utcNow()]"
      }      
    },
    "resources": [
      {
        "type": "Microsoft.Resources/deploymentScripts",
        "apiVersion": "2020-10-01",
        "name": "runPowerShellInlineWithOutput",
        "location": "[resourceGroup().location]",
        "kind": "AzurePowerShell",
        "identity": {
          "type": "userAssigned",
          "userAssignedIdentities": {
            "/subscriptions/0548f072-39c5-4986-864d-14d0395af3b7/resourceGroups/PSTest/providers/Microsoft.ManagedIdentity/userAssignedIdentities/PStestID": {}
            }
          },
        "properties": {
          "forceUpdateTag": "[parameters('utcValue')]",
          "azPowerShellVersion": "6.4",
          "primaryScriptUri": "https://raw.githubusercontent.com/henrikmotzkus/AutomationDemo/main/20_PowerShellinARM/azuredeploy.ps1",
          "arguments": "[format(' -DisplayName {0} -Description {1} -CompanyName {2} -Secret {3}', parameters('DisplayName'), parameters('Description'), parameters('CompanyName'), parameters('Secret'))]",
          "timeout": "PT1H",
          "cleanupPreference": "OnSuccess",
          "retentionInterval": "P1D"
        }
      }
    ],
    "outputs": {
      "result": {
        "value": "[reference('runPowerShellInlineWithOutput').outputs.text]",
        "type": "string"
      }
    }
  }